{% extends "base.html" %}

{% block title %}Researcher Profile - Academic Network{% endblock %}

{% block content %}
    <div class="container mt-4">
        <!-- Profile Header -->
        <div class="profile-header">
            <div class="row">
                <div class="col-md-3 text-center">
                    <div class="profile-pic-container">
                        <img id="profile-pic" src="https://via.placeholder.com/200x200/6c757d/ffffff?text=Profile+Pic" 
                             alt="Profile Picture" class="profile-pic">
                        <button class="change-pic-btn" onclick="document.getElementById('profile-pic-input').click()">
                            <i class="fas fa-camera"></i>
                        </button>
                        <input type="file" id="profile-pic-input" accept="image/*" style="display: none;" 
                               onchange="changeProfilePic(this)">
                    </div>
                </div>
                <div class="col-md-9">
                    <div class="profile-info">
                        <h1 id="researcher-name">{{ researcher.first_name }} {{ researcher.last_name }}</h1>
                        <p class="title" id="researcher-title">{{ researcher.position or 'Position not specified' }}</p>
                        <p class="institution" id="researcher-institution">{{ researcher.institution or 'Institution not specified' }}</p>
                        {% if researcher.profile and researcher.profile.location %}
                        <p class="location" id="researcher-location">
                            <i class="fas fa-map-marker-alt me-1"></i>{{ researcher.profile.location }}
                        </p>
                        {% endif %}
                        <p class="bio" id="researcher-bio">
                            {% if researcher.profile and researcher.profile.bio %}
                                {{ researcher.profile.bio }}
                            {% else %}
                                No bio available. Click "Edit Profile" to add your bio.
                            {% endif %}
                        </p>
                        
                        <!-- Social Media Links -->
                        <div class="social-links">
                            {% if researcher.profile %}
                                {% for social in researcher.profile.socials %}
                                    {% if social.platform == 'LinkedIn' %}
                                        <a href="{{ social.url }}" class="social-link linkedin" target="_blank">
                                            <i class="fab fa-linkedin"></i> LinkedIn
                                        </a>
                                    {% elif social.platform == 'Twitter' %}
                                        <a href="{{ social.url }}" class="social-link twitter" target="_blank">
                                            <i class="fab fa-twitter"></i> Twitter
                                        </a>
                                    {% elif social.platform == 'Instagram' %}
                                        <a href="{{ social.url }}" class="social-link instagram" target="_blank">
                                            <i class="fab fa-instagram"></i> Instagram
                                        </a>
                                    {% elif social.platform == 'GitHub' %}
                                        <a href="{{ social.url }}" class="social-link github" target="_blank">
                                            <i class="fab fa-github"></i> GitHub
                                        </a>
                                    {% endif %}
                                {% endfor %}
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Profile Actions -->
        {% if is_owner %}
        <div class="profile-actions">
            <a href="{{ url_for('main.edit_profile') }}" class="btn btn-primary">
                <i class="fas fa-edit"></i> Edit Profile
            </a>
            <button class="btn btn-success" onclick="addNewPaper()">
                <i class="fas fa-plus"></i> Add New Paper
            </button>
            <button class="btn btn-info" onclick="managePapers()">
                <i class="fas fa-file-alt"></i> Manage Papers
            </button>
        </div>
        {% endif %}

        <!-- Recent Papers -->
        <div class="papers-section">
            <div class="section-header">
                <h2>Recent Papers</h2>
                <button class="btn btn-outline-primary btn-sm" onclick="viewAllPapers()">View All</button>
            </div>
            <div class="papers-grid" id="recent-papers">
                <!-- Papers will be dynamically loaded here -->
            </div>
        </div>

        <!-- Research Interests -->
        <div class="interests-section">
            <div class="section-header">
                <h2>Research Interests</h2>
                <button class="btn btn-outline-primary btn-sm" onclick="editInterests()">Edit</button>
            </div>
            <div class="interests-tags" id="research-interests">
                <span class="interest-tag">Machine Learning</span>
                <span class="interest-tag">Artificial Intelligence</span>
                <span class="interest-tag">Data Science</span>
                <span class="interest-tag">Neural Networks</span>
                <span class="interest-tag">Computer Vision</span>
            </div>
        </div>
        
        <!-- Logout Section -->
        <div class="logout-section text-center py-4">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-md-6">
                        <div class="logout-card">
                            <h4 class="mb-3">Account Management</h4>
                            <p class="text-muted mb-4">Manage your account settings and logout when you're done.</p>
                            <a href="{{ url_for('auth.logout') }}" class="btn btn-danger btn-lg">
                                <i class="fas fa-sign-out-alt me-2"></i>Sign Out
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->

    <!-- Add Paper Modal -->
    <div class="modal fade" id="addPaperModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add New Paper</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="add-paper-form">
                        <div class="mb-3">
                            <label class="form-label">Paper Title *</label>
                            <input type="text" class="form-control" id="paper-title" required>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Authors *</label>
                                    <input type="text" class="form-control" id="paper-authors" required>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Publication Year *</label>
                                    <input type="number" class="form-control" id="paper-year" min="1900" max="2030" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Journal/Conference</label>
                                    <input type="text" class="form-control" id="paper-venue">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">DOI</label>
                                    <input type="text" class="form-control" id="paper-doi" placeholder="10.1000/...">
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Abstract</label>
                            <textarea class="form-control" id="paper-abstract" rows="4"></textarea>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Keywords</label>
                            <input type="text" class="form-control" id="paper-keywords" placeholder="Separate with commas">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">PDF File</label>
                            <input type="file" class="form-control" id="paper-pdf" accept=".pdf">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="submitPaper()">Add Paper</button>
                </div>
            </div>
        </div>
    </div>

{% endblock %}

{% block extra_js %}
    <script>
        // Sample papers data
        const samplePapers = [
            {
                title: "Advanced Neural Network Architectures for Image Recognition",
                authors: "Smith, J., Johnson, A., Williams, B.",
                year: 2023,
                venue: "International Conference on Computer Vision",
                citations: 45,
                abstract: "This paper presents novel neural network architectures..."
            },
            {
                title: "Machine Learning Approaches to Big Data Analysis",
                authors: "Smith, J., Brown, C.",
                year: 2022,
                venue: "Journal of Machine Learning Research",
                citations: 32,
                abstract: "We explore various machine learning techniques..."
            },
            {
                title: "Deep Learning Applications in Natural Language Processing",
                authors: "Smith, J., Davis, E., Wilson, F.",
                year: 2021,
                venue: "Neural Information Processing Systems",
                citations: 67,
                abstract: "This research investigates the application of deep learning..."
            }
        ];

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            loadRecentPapers();
            updateStats();
        });

        // Load recent papers
        function loadRecentPapers() {
            const papersContainer = document.getElementById('recent-papers');
            papersContainer.innerHTML = '';
            
            samplePapers.forEach(paper => {
                const paperCard = createPaperCard(paper);
                papersContainer.appendChild(paperCard);
            });
        }

        // Create paper card
        function createPaperCard(paper) {
            const card = document.createElement('div');
            card.className = 'paper-card';
            card.innerHTML = `
                <h3>${paper.title}</h3>
                <p class="authors">${paper.authors}</p>
                <p class="venue">${paper.venue} (${paper.year})</p>
                <p class="citations"><i class="fas fa-quote-left"></i> ${paper.citations} citations</p>
                <p class="abstract">${paper.abstract}</p>
                <div class="paper-actions">
                    <button class="btn btn-sm btn-outline-primary">View Details</button>
                    <button class="btn btn-sm btn-outline-secondary">Download PDF</button>
                </div>
            `;
            return card;
        }

        // Update statistics
        function updateStats() {
            const papersCountEl = document.getElementById('papers-count');
            const citationsCountEl = document.getElementById('citations-count');
            if (papersCountEl) papersCountEl.textContent = samplePapers.length;
            if (citationsCountEl) {
                const totalCitations = samplePapers.reduce((sum, paper) => sum + paper.citations, 0);
                citationsCountEl.textContent = totalCitations.toLocaleString();
            }
        }

        // Change profile picture
        function changeProfilePic(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('profile-pic').src = e.target.result;
                };
                reader.readAsDataURL(input.files[0]);
            }
        }


        // Add new paper
        function addNewPaper() {
            const modal = new bootstrap.Modal(document.getElementById('addPaperModal'));
            modal.show();
        }

        // Submit paper
        function submitPaper() {
            const title = document.getElementById('paper-title').value;
            const authors = document.getElementById('paper-authors').value;
            const year = document.getElementById('paper-year').value;
            const venue = document.getElementById('paper-venue').value;
            const doi = document.getElementById('paper-doi').value;
            const abstract = document.getElementById('paper-abstract').value;
            const keywords = document.getElementById('paper-keywords').value;

            if (!title || !authors || !year) {
                showNotification('Please fill in all required fields.', 'error');
                return;
            }

            // Create new paper object
            const newPaper = {
                title: title,
                authors: authors,
                year: parseInt(year),
                venue: venue,
                doi: doi,
                abstract: abstract,
                keywords: keywords,
                citations: 0
            };

            // Add to papers array
            samplePapers.unshift(newPaper);

            // Reload papers and update stats
            loadRecentPapers();
            updateStats();

            // Close modal and reset form
            const modal = bootstrap.Modal.getInstance(document.getElementById('addPaperModal'));
            modal.hide();
            document.getElementById('add-paper-form').reset();

            showNotification('Paper added successfully!', 'success');
        }

        // Manage papers
        function managePapers() {
            showNotification('Paper management feature coming soon!', 'info');
        }

        // View all papers
        function viewAllPapers() {
            showNotification('Full papers list coming soon!', 'info');
        }

        // Edit interests
        function editInterests() {
            showNotification('Interest editing feature coming soon!', 'info');
        }

        // Show notification
        function showNotification(message, type) {
            // Create notification element
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.innerHTML = `
                <div class="notification-content">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                    <span>${message}</span>
                </div>
            `;

            // Add to page
            document.body.appendChild(notification);

            // Show notification
            setTimeout(() => notification.classList.add('show'), 100);

            // Remove after 3 seconds
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }
    </script>
{% endblock %}
